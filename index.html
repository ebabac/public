<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Form - Login</title>
    <script>
        let customers = {
            "user1": { password: "pass123", labourRates: { "000001": 50, "000002": 75 }, goodsDiscounts: { "ItemA": 10, "ItemB": 5 }, currency: "USD" },
            "user2": { password: "pass456", labourRates: { "000001": 60, "000002": 80 }, goodsDiscounts: { "ItemA": 15, "ItemB": 8 }, currency: "EUR" }
        };

        let currentUser = null;

        function login() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            
            if (customers[username] && customers[username].password === password) {
                currentUser = customers[username];
                document.getElementById("login-section").style.display = "none";
                document.getElementById("form-section").style.display = "block";
                updateTotals();
            } else {
                alert("Invalid login. Please try again.");
            }
        }

        function updateTotals() {
            if (!currentUser) return;

            let selectedLabour = document.getElementById("labour").selectedOptions;
            let selectedGoods = document.getElementById("goods").selectedOptions;
            let currency = currentUser.currency;
            
            let labourTotal = 0;
            for (let option of selectedLabour) {
                let code = option.value;
                labourTotal += currentUser.labourRates?.[code] || 0;
            }
            
            let goodsTotal = 0;
            for (let option of selectedGoods) {
                let item = option.value;
                goodsTotal += 100 - (currentUser.goodsDiscounts?.[item] || 0); // Assume base price 100
            }
            
            let total = labourTotal + goodsTotal;
            document.getElementById("total").innerText = `Total: ${total.toFixed(2)} ${currency}`;
        }

        function submitForm() {
            if (!currentUser) return;

            let formData = {
                user: document.getElementById("username").value,
                labour: Array.from(document.getElementById("labour").selectedOptions).map(o => o.value),
                goods: Array.from(document.getElementById("goods").selectedOptions).map(o => o.value),
                currency: currentUser.currency,
                total: document.getElementById("total").innerText
            };
            
            fetch("YOUR_POWER_AUTOMATE_FLOW_URL", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            }).then(response => alert("Order submitted successfully!"))
              .catch(error => alert("Error submitting order."));
        }
    </script>
</head>
<body>
    <div id="login-section">
        <h2>Login</h2>
        <label>Username:</label>
        <input type="text" id="username">
        <label>Password:</label>
        <input type="password" id="password">
        <button onclick="login()">Login</button>
    </div>

    <div id="form-section" style="display:none;">
        <h2>Order Form</h2>
        <label>Labour Codes:</label>
        <select id="labour" multiple onchange="updateTotals()">
            <option value="000001">Fault memory check</option>
            <option value="000002">Fault memory clear</option>
        </select>
        
        <label>Goods:</label>
        <select id="goods" multiple onchange="updateTotals()">
            <option value="ItemA">Item A</option>
            <option value="ItemB">Item B</option>
        </select>
        
        <h3 id="total">Total: 0</h3>
        <button onclick="submitForm()">Submit</button>
    </div>
</body>
</html>
